#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdint.h>
#include <assert.h>

// Compiled using the command gcc -O0 -m64 -g -fno-stack-protector ROP-contrived.c -o ROP-contrived
char tmp_buffer[1000];

int main(int argc, char **argv) {
  if(argc != 2) {
    exit(1);
  }
  system("echo Hello");
  int n = get_input(argv[1], tmp_buffer);
  char stack_buffer[256];
  memcpy(stack_buffer, tmp_buffer, n);
  return 0;
}

void f1() {
  asm("popq %rax");
}


void f2() {
  asm("movq %rax, %rdi");
}

int get_input(char* filename, char* input_buf) {
  FILE *f = fopen(filename, "rb");
  fseek(f, 0, SEEK_END);
  long fsize = ftell(f);
  if (fsize >= 350)
    fsize = 350;

  fseek(f, 0, SEEK_SET);  //same as rewind(f);

  fread(input_buf, fsize, 1, f);
  fclose(f);
  input_buf[fsize] = 0;
  return fsize;
}
