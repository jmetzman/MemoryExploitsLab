#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include <assert.h>

enum {
  FIELD_SZ = 8,
  NONFREE_MALLOC_CHUNK_SZ = 2 * FIELD_SZ,
  DATA_SZ = NONFREE_MALLOC_CHUNK_SZ * 8,
  USER_CHARS_SZ = 220,
};

char* user_data_arr[1];

char user_input[USER_CHARS_SZ];

int get_input(char* filename, char* input_buf) {
  FILE *f = fopen(filename, "rb");
  fseek(f, 0, SEEK_END);
  long fsize = ftell(f);
  if (fsize >= 300)
    fsize = 300;

  fseek(f, 0, SEEK_SET);  //same as rewind(f);

  fread(input_buf, fsize, 1, f);
  fclose(f);
  input_buf[fsize] = 0;
  return fsize;
}


int main(int argc, char** argv) {
  assert(argc > 1);

  int x;
  printf("address in stack: %p\n", &x);

  user_data_arr[0] = (char*) malloc(DATA_SZ);
  assert(user_data_arr[0]);
  


  uint64_t* program_data_ptr = (uint64_t*) malloc(DATA_SZ);
  assert(program_data_ptr);

  int i;
  for (i = 0; i < argc-1; i++) {
    int sz = get_input(argv[i+1], user_input);
    int j;
    char* arr = user_data_arr[0];
    for (j = 0; j < sz; j++) {
      arr[j] = user_input[j];
    }
 
    if (i == 0) {
      free(program_data_ptr);
    }
  }

  return 0;
}
