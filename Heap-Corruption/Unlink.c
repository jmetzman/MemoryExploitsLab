#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include <assert.h>

enum {
  FIELD_SZ = 8,
  NONFREE_MALLOC_CHUNK_SZ = 2 * FIELD_SZ,
  DATA_SZ = NONFREE_MALLOC_CHUNK_SZ * 8,
  USER_CHARS_SZ = 200,
};

uint64_t* pointer_arr[4];
char user_input[USER_CHARS_SZ];

int get_input(char* filename, char* input_buf) {
  FILE *f = fopen(filename, "rb");
  fseek(f, 0, SEEK_END);
  long fsize = ftell(f);
  if (fsize >= 160)
    fsize = 160;

  fseek(f, 0, SEEK_SET);  //same as rewind(f);

  fread(input_buf, fsize, 1, f);
  fclose(f);
  input_buf[fsize] = 0;
  return fsize;
}

int main(int argc, char** argv) {
  assert(argc > 1);
  uint64_t* data_ptr = (uint64_t*) malloc(DATA_SZ);
  pointer_arr[0] = data_ptr; // user data gets written here
  assert(data_ptr);

  data_ptr = (uint64_t*) malloc(DATA_SZ);
  assert(data_ptr);
  pointer_arr[1] = data_ptr;  // program data goes here

  int i;
  for (i = 0; i < argc-1; i++) {
    int sz = get_input(argv[i+1], user_input);
    char* arr = (char*) pointer_arr[0];
    int j;
    for (j = 0; j < sz; j++) {
      arr[j] = user_input[j];
    }
    if (i == 0) {
      free(pointer_arr[1]);
    }
  }

  return 0;
}
