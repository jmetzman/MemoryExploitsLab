// Compiled using:
// zsh ./Privilege-Escalation-setup.sh
//

// Run using:
// $ zsh ./Privilege-Escalation-setup.sh

#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>

void append_guest(char* name) {
  FILE *stream;
  char *myname;

  setuid(0);
  char* base_command = "echo %s >> guestbook.txt";
  char* command;
  asprintf(&command, base_command, name);
  system(command);
  free(command);
}

int main(int argc, char** argv){
  if (argc != 2) {
    puts("Please pass your name as an argument (e.g. $ ./Privilege-Escalation John)");
    exit(EXIT_FAILURE);
  }
  /* Remember the real and effective user IDs.  */
  append_guest(argv[1]);
  printf("Added %s to the guestbook\n", argv[1]);

  return 0;
}
